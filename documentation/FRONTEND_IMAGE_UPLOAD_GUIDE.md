# Frontend Image Upload Guide for Social Posts

## ‚úÖ Solution: Upload Images Directly from Device

**Good News**: The backend now handles image uploads automatically!

**How it works**:
1. **Frontend uploads images from device** (as files)
2. **Backend automatically uploads to S3** (if S3 is enabled)
3. **Backend generates URLs** and saves them to the database
4. **Backend returns URLs** in the response

## üìã How to Upload Images

### ‚úÖ Upload Files Directly from Device (RECOMMENDED)

**The backend will automatically:**
1. Receive the files from frontend
2. Upload them to S3 (if S3 is enabled)
3. Generate URLs
4. Save URLs to database
5. Return URLs in the response

**Frontend code:**

```javascript
// User selects images from device
const selectedFiles = [...fileInput.files];

// Create FormData
const formData = new FormData();
formData.append('caption', caption);
formData.append('privacy', 'public');
formData.append('tags', JSON.stringify(tags));

// Add images - backend will handle S3 upload automatically
selectedFiles.forEach((file) => {
  formData.append('images_data', file); // Use 'images_data' field
  // OR use 'images' for legacy support
  // formData.append('images', file);
});

// Send request
const response = await fetch('/api/v1/social/posts/', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    // ‚ö†Ô∏è IMPORTANT: Don't set Content-Type header!
    // Browser will automatically set it with boundary for FormData
  },
  body: formData
});

const result = await response.json();
// result.data.images will contain the URLs generated by backend
console.log('Image URLs:', result.data.images);
```

### Option 2: Use `image_urls` (Alternative)

If you prefer to upload to cloud storage yourself first:

```javascript
// 1. Upload images to your cloud storage (S3, Cloudinary, etc.)
const imageUrls = await uploadToCloudStorage(files);

// 2. Send URLs to backend
const response = await fetch('/api/v1/social/posts/', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`,
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    caption: caption,
    privacy: 'public',
    tags: tags,
    image_urls: imageUrls // Array of URLs
  })
});
```

## üîß Backend Configuration

**For file uploads to work, S3 must be enabled:**

Set these environment variables in Vercel:
```
USE_S3=True
AWS_ACCESS_KEY_ID=your_key
AWS_SECRET_ACCESS_KEY=your_secret
AWS_STORAGE_BUCKET_NAME=your_bucket
AWS_S3_REGION_NAME=us-east-1
```

**If S3 is NOT enabled:**
- File uploads will fail on Vercel (read-only filesystem)
- Frontend must use `image_urls` field instead (upload to cloud storage first)

## üìù Required Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `caption` | string | ‚úÖ Yes | Post caption (cannot be blank) |
| `privacy` | string | No | `'public'`, `'private'`, or `'friends'` (default: `'public'`) |
| `tags` | array | No | Array of tag strings (e.g., `['fashion', 'ootd']`) |
| `images_data` | array | ‚úÖ Recommended | Array of image files (backend uploads to S3) |
| `image_urls` | array | Alternative | Array of image URLs (if you upload to cloud storage first) |
| `outfit_id` | integer | No | Optional outfit ID to link to post |
| `location_name` | string | No | Location name |
| `location_lat` | float | No | Latitude |
| `location_lng` | float | No | Longitude |

## üîç How to Debug

### Check What's Being Sent

1. **Open browser DevTools ‚Üí Network tab**
2. **Find the POST request to `/api/v1/social/posts/`**
3. **Check the Request Payload**:
   - Are files being sent? (Look for `FormData` entries)
   - What field names are being used? (`images_data`, `images`, or `image_urls`)

### Check Backend Logs

The backend now logs:
- All request data keys
- All FILES keys
- File information (name, size, content_type)
- Whether images were found and saved
- S3 upload status

Look for these log messages in Vercel:
- `"Creating post with data keys: [...]"`
- `"Creating post with FILES keys: [...]"`
- `"Found X images in request.FILES"`
- `"Uploaded image X to S3 for post Y"` (if S3 enabled)
- `"Cannot save image to filesystem (read-only)"` (if S3 not enabled)

## ‚ö†Ô∏è Common Mistakes

1. **Setting Content-Type header with FormData** - Don't do this! Browser sets it automatically
2. **Wrong field name** - Use `images_data` (plural) or `images` (legacy), not `image` (singular)
3. **S3 not enabled** - File uploads will fail on Vercel if S3 is not configured
4. **Sending as JSON** - Files must be sent as FormData, not JSON

## ‚úÖ Verification

After creating a post, check:
1. **Post is created** - Check `posts` table in database
2. **Images are saved** - Check `post_images` table:
   ```sql
   SELECT * FROM post_images WHERE post_id = <post_id>;
   ```
   - Should have entries with `image` field (S3 URL if S3 enabled)
   - Or `image_url` field (if using image_urls)

## üìû Summary

**For Frontend Team:**
- ‚úÖ **Just upload files directly** using `images_data` field
- ‚úÖ **Backend handles S3 upload automatically** (if S3 is enabled)
- ‚úÖ **Backend returns URLs** in the response
- ‚ö†Ô∏è **Make sure S3 is enabled** in Vercel environment variables
- ‚ö†Ô∏è **Don't set Content-Type header** when using FormData

**For Backend Team:**
- ‚úÖ Code is ready to handle file uploads
- ‚úÖ Automatically uploads to S3 if `USE_S3=True`
- ‚úÖ Falls back gracefully if S3 not enabled
- ‚ö†Ô∏è **Need to enable S3** in Vercel for file uploads to work
